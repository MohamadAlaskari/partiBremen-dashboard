<div>
  <div class="row">
    <!--create new poi-->
    <div class="col-md-4">
      <h4 class="mb-4">Create new POI</h4>
      <form [formGroup]="formData" (ngSubmit)="submitForm()">
        <div class="col-12">
          <div class="form-floating">
            <input type="text" class="form-control" id="titel" placeholder="" formControlName="titel"
              autocomplete="current-titel"
              [class.is-invalid]="formData.get('titel')!.invalid && formData.get('titel')!.touched"
              [class.is-valid]="formData.get('titel')!.valid && formData.get('titel')!.touched">
            <label for="titel" class="form-label">Titel*</label>
            <div *ngIf="formData.get('titel')!.invalid && formData.get('titel')!.touched" class="invalid-feedback">
              Please provide a valid titel.
            </div>
          </div>
        </div>

        <div class="col-12 mt-3">
          <div class="form-floating">
            <textarea class="form-control" rows="20" cols="50" placeholder="Leave a comment here" id="floatingTextarea"
              formControlName="description" style="height: 280px;"
              [class.is-invalid]="formData.get('description')!.invalid && formData.get('description')!.touched"
              [class.is-valid]="formData.get('description')!.valid && formData.get('description')!.touched"></textarea>
            <label for="floatingTextarea">Description</label>
            <div *ngIf="formData.get('description')!.invalid && formData.get('description')!.touched"
              class="invalid-feedback">
              Please provide a valid description.
            </div>
          </div>
        </div>

        <button type="submit" class="btn btn-dark btn-lg mx-auto col-12 mt-3">Add new POI</button>
      </form>

    </div>
    <div class="col-md-8">
      <div class="mb-3 d-flex gap-2">
        <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="Search...">
        <button id="mapButton" class="btn btn-dark mx-auto" type="button" data-toggle="tooltip"
          title="Click to indicate location on map">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
            class="feather feather-plus">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
        <!-- Button trigger modal -->



      </div>
      <div id="map" style="height: 454px;"></div>

    </div>
  </div>
</div>


<!--all pois cards-->
<div class="row mt-3 border-top-3">
  <div class="col-12">
    <div class="row">

      <ng-container *ngIf="pois; else noPois">
        <div class="col-md-3 mb-3" *ngFor="let poi of pois; track $index">
          <div class="poi-card card h-100" data-bs-toggle="modal" data-bs-target="#poiModal"
            (click)="selectPoi(poi.id)">
            <img [src]="poi.img" class="card-img-top" alt="POI image">
            <div class="card-body d-flex flex-column">
              <!-- Voting system -->
              <div class="d-flex justify-content-between">
                <div (click)="vote(poi.id, 'UP')" class="d-flex align-items-center svg-bold">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-arrow-up" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                      d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5" />
                  </svg>
                  <span class="small-caps-bold">{{ getVoteCount(poi.id, 'UP') }} up</span>
                </div>
                <div (click)="vote(poi.id, 'DOWN')" class="d-flex align-items-center svg-bold ">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-arrow-down" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                      d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1" />
                  </svg>
                  <span class="small-caps-bold">{{ getVoteCount(poi.id, 'DOWN') }} down</span>
                </div>
              </div>
              <!-- POI Details -->
              <div class="d-flex justify-content-between py-2">
                <h6 class="my-0 text-secondary">{{ poi.creator.name }} {{ poi.creator.surname }}</h6>
              </div>
              <h5 class="card-title">{{ poi.titel }}</h5>
              <p class="card-text text-truncate">{{ poi.description }}</p>
              <p class="card-text text-secondary small">{{ poi.createdAt | date:'dd MMM yyyy' }}</p>
            </div>
          </div>
        </div>
      </ng-container>
      <ng-template #noPois>
        <p>This user doesn't have any POIs yet!</p>
      </ng-template>
    </div>
  </div>
</div>



<!--map poi Modal -->
<div #poiModal class="modal fade" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      @if (selectedPoi ) {


      <div class="modal-header">
        <div class="comment-box d-flex align-items-start p-2 w-100">

          <h5 class="modal-title" id="poiModalLabel">{{ selectedPoi.creator.name }} {{ selectedPoi.creator.surname }} <a
              class="replink" (click)="selectReport('user', selectedPoi.creator.id,selectedPoi.creator.name)"
              [class.selected]="selectedReportType === 'user'">report user</a>
          </h5>


          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>


      <div class="modal-body">
        <div class="row">

          <!-- POI Details Section -->
          <div class="col-md-6">
            <img
              [src]="'https://images.unsplash.com/photo-1542386649-58d7ed0249bf?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8YnJlbWVufGVufDB8fDB8fHww'"
              class="img-fluid mb-3 card-img-top" alt="POI image">
            <h5 class="modal-title" id="poiModalLabel">{{ selectedPoi.titel }}</h5>
            <p>{{ selectedPoi.description }}</p>
            <p class="text-secondary small">{{ selectedPoi.createdAt | date:'dd MMM yyyy, HH:mm' }}</p>
            <small class="text-secondary"><a class="replink"
                (click)="selectReport('poi', selectedPoi.id,selectedPoi.titel)"
                [class.selected]="selectedReportType === 'poi'">report poi</a></small>
            <div class="d-flex justify-content-between">
              <div class="d-flex align-items-center svg-bold">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-arrow-up vote-svg" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5" />
                </svg>
                <span class="small-caps-bold">{{ getVoteCount(selectedPoi.id || '', 'UP') }} up</span>
              </div>
              <div class="d-flex align-items-center svg-bold">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-arrow-down vote-svg" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1" />
                </svg>
                <span class="small-caps-bold">{{ getVoteCount(selectedPoi.id || '', 'DOWN') }} down</span>
              </div>
            </div>
          </div>

          <!-- Comments Section -->

          <div class="col-md-6">
            <h5>Comments</h5>
            <div class="comment-list overflow-auto" style="max-height: 400px;">
              @for (comment of selectedPoi.comments; track comment.id) {
              <!--comments-->
              <div class="comment-box d-flex align-items-start p-2 w-100">
                <div class="bg-dark p-1 fw-bold small d-flex align-items-center justify-content-center rounded-circle">
                  <div class="initials text-white">
                    {{ getInitials(comment.commenter.name, comment.commenter.surname) }}
                  </div>
                </div>
                <div class="comment-content ps-2">
                  <h6 class="text-dark mb-0">{{comment.commenter.name}} {{comment.commenter.surname}}</h6>
                  <p class="small">{{ comment.actualcomment }}</p>
                  <small class="text-secondary">{{ comment.createdAt | date:'dd MMM yyyy, HH:mm' }}</small>
                  <small class="text-secondary">
                    <a class="replink" (click)="selectReport('comment', comment.id,comment.commenter.name)"
                      [class.selected]="selectedReportItemId === comment.id">report comment</a>
                  </small>
                </div>
              </div>
              }@empty {
              <p class="opacity-50">no comments vorhanden yet!</p>
              }

            </div>

            <!--add comment-->
            <div class="input-group mb-3">
              <input #commentInput type="text" #commentText placeholder="Add a comment" class="form-control"
                aria-label="Recipient's username" aria-describedby="button-addon2">
              <button (click)="addComment(selectedPoi.id || '', commentInput.value || '', commentInput)"
                class=" btn btn-outline-secondary" type="button" id="button-addon2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-play-fill" viewBox="0 0 16 16">
                  <path
                    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393" />
                </svg>
              </button>
            </div>
            <div class="reportform" *ngIf="selectedReportType">
              <form [formGroup]="reportForm" (ngSubmit)="Submitreport()">
                <div class="inline-container">
                  <p>You are reporting on: </p>
                  <p *ngIf="selectedReportType === 'comment'">{{title}} comment</p>
                  <p *ngIf="selectedReportType === 'poi'">this poi "{{title}}"</p>
                  <p *ngIf="selectedReportType === 'user'">{{title}}</p>
                </div>

                <input formControlName="title" type="text" placeholder="Report title..." class="report-title">
                <textarea formControlName="kommentar" placeholder="Report details..." class="report-details"></textarea>

                <button type="button" class="close-btn" (click)="closeForm()">
                  <span>&times;</span> <!-- Close icon -->
                </button>

                <button class="submit-btn" type="submit">Submit</button>
              </form>
            </div>



          </div>
        </div>
      </div>


      } @else {
      <div class="d-flex align-items-center">
        <strong role="status">Loading...</strong>
        <div class="spinner-border ms-auto" aria-hidden="true"></div>
      </div>
      }

    </div>
  </div>
</div>

<!-- poi Modal -->

<div class="modal fade" id="poiModal" tabindex="-1" aria-labelledby="poiModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      @if (selectedPoi ) {


      <div class="modal-header">
        <div class="comment-box d-flex align-items-start p-2 w-100">

          <h5 class="modal-title" id="poiModalLabel">{{ selectedPoi.creator.name }} {{ selectedPoi.creator.surname }}
          </h5>


          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>


      <div class="modal-body">
        <div class="row">

          <!-- POI Details Section -->
          <div class="col-md-6">
            <img
              [src]="'https://images.unsplash.com/photo-1542386649-58d7ed0249bf?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8YnJlbWVufGVufDB8fDB8fHww'"
              class="img-fluid mb-3 card-img-top" alt="POI image">
            <h5 class="modal-title" id="poiModalLabel">{{ selectedPoi.titel }}</h5>
            <p>{{ selectedPoi.description }}</p>
            <p class="text-secondary small">{{ selectedPoi.createdAt | date:'dd MMM yyyy, HH:mm' }}</p>
            <div class="d-flex justify-content-between">
              <div class="d-flex align-items-center svg-bold">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-arrow-up vote-svg" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5" />
                </svg>
                <span class="small-caps-bold">{{ getVoteCount(selectedPoi.id || '', 'UP') }} up</span>
              </div>
              <div class="d-flex align-items-center svg-bold">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-arrow-down vote-svg" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1" />
                </svg>
                <span class="small-caps-bold">{{ getVoteCount(selectedPoi.id || '', 'DOWN') }} down</span>
              </div>
            </div>
          </div>

          <!-- Comments Section -->

          <div class="col-md-6">
            <h5>Comments</h5>
            <div class="comment-list overflow-auto" style="max-height: 400px;">
              <div *ngIf="selectedPoi.comments && selectedPoi.comments.length > 0; else noComments">
                <div *ngFor="let comment of selectedPoi.comments; trackBy: trackByCommentId">
                  <!--comments-->
                  <div class="comment-box d-flex align-items-start p-2 w-100">
                    <div
                      class="bg-dark p-1 fw-bold small d-flex align-items-center justify-content-center rounded-circle">
                      <div class="initials text-white">
                        {{ getInitials(comment.commenter.name, comment.commenter.surname) }}
                      </div>
                    </div>
                    <div class="comment-content ps-2">
                      <h6 class="text-dark mb-0">{{ comment.commenter.name }} {{ comment.commenter.surname }}</h6>
                      <p class="small">{{ comment.actualcomment }}</p>
                      <small class="text-secondary">{{ comment.createdAt | date:'dd MMM yyyy, HH:mm' }}</small>
                    </div>
                  </div>
                  <!--add comment-->
                </div>
              </div>

              <ng-template #noComments>
                <p class="opacity-50">no comments vorhanden yet!</p>
              </ng-template>


            </div>

            <!--add comment-->
            <div class="input-group mb-3">
              <input #commentInput type="text" #commentText placeholder="Add a comment" class="form-control"
                aria-label="Recipient's username" aria-describedby="button-addon2">
              <button (click)="addComment(selectedPoi.id || '', commentInput.value || '', commentInput)"
                class=" btn btn-outline-secondary" type="button" id="button-addon2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-play-fill" viewBox="0 0 16 16">
                  <path
                    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393" />
                </svg>
              </button>
            </div>

          </div>
        </div>
      </div>


      } @else {
      <div class="d-flex align-items-center">
        <strong role="status">Loading...</strong>
        <div class="spinner-border ms-auto" aria-hidden="true"></div>
      </div>
      }

    </div>
  </div>
</div>